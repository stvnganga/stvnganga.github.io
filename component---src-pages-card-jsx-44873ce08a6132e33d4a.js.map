{"version":3,"file":"component---src-pages-card-jsx-44873ce08a6132e33d4a.js","mappings":"0TAAO,IAAMA,EAAgB,gBAChBC,EAAmB,mBACnBC,EAAoB,oBACpBC,EAAiB,iBAEf,SAAS,IACtB,OAAO,IACR,C,sGCEKC,EAAU,IAAIC,iBAAiB,WAEtB,SAASC,IACtB,OAA0BC,EAAAA,EAAAA,UAAS,IAA5BC,EAAP,KAAcC,EAAd,KACA,GAAsCF,EAAAA,EAAAA,UAAS,CAAEG,KAAMF,IAAhDG,EAAP,KAAoBC,EAApB,KACA,GAAoCL,EAAAA,EAAAA,UAAS,MAAtCM,EAAP,KAAmBC,EAAnB,KAEMC,EAAoB,SAACC,EAAMR,GAAP,OACxBI,GAAe,SAACK,GAAD,aAAUC,OAAOC,OAAO,CAAC,EAAGF,IAAlB,MAA2BD,GAAOR,EAAlC,GAAV,GADS,EA4F1B,OAhDAY,EAAAA,EAAAA,YAAU,WACJC,SACFA,OAAOC,UAAY,SAACC,GACdA,EAAMN,KAAKO,cAAgBxB,EAAAA,gBAC7Bc,EAAcS,EAAMN,KAAKA,MACzBb,EAAQqB,YAAY,CAClBD,YAAavB,EAAAA,mBAGlB,EAEDG,EAAQkB,UAAY,SAACC,GACfA,EAAMN,KAAKO,cAAgBtB,EAAAA,oBAC7BwB,QAAQC,IAAI,2BAA4BJ,EAAMN,MAC9CF,EAAkBQ,EAAMN,KAAKD,KAAMO,EAAMN,KAAKT,OAEjD,EAEJ,GAAE,KAEHY,EAAAA,EAAAA,YAAU,WACJT,EAAYiB,KAAOjB,EAAYkB,QAAUlB,EAAYD,OACvDgB,QAAQC,IAAI,kCAAZ,iBACKhB,EACAE,IAEmB,SAApBF,EAAYiB,KACdE,EAAAA,EAAAA,SAAoB,CAClBC,KAAM,gBACNP,YAAa,iBACbP,KAAM,CACJe,QAAS,iBACTC,WAAY,QAIhBH,EAAAA,EAAAA,SAAoB,CAClBC,KAAM,gBACNP,YAAa,iBACbP,KAAM,CACJe,QAAS,eACTC,WAAY,OAKrB,GAAE,CAACtB,IAGF,yBACEuB,KAAK,OACLlB,KAAK,OACLmB,YAAY,kBACZ3B,MAAOA,EACP4B,SA/FiB,SAACC,GACpBX,QAAQC,IAAI,0BACZ,IAAQnB,EAAU6B,EAAOC,OAAjB9B,MAEJ,gBAAgB+B,KAAK/B,KACvBC,EAASD,GACTO,EAAkB,OAAQP,IAC1BsB,EAAAA,EAAAA,SAAoB,CAClBC,KAAM,OACNP,YAAa,aACbP,KAAM,CACJuB,MAAO,iBAAiBD,KAAK/B,MAIpC,EAiFGiC,QA/EgB,WAClBf,QAAQC,IAAI,2BACZG,EAAAA,EAAAA,SAAoB,CAClBC,KAAM,OACNP,YAAa,QACbP,KAAM,CACJyB,UAAW,UACXlC,OAAO,IAGZ,EAsEGmC,OApEe,WACjBjB,QAAQC,IAAI,2BACZG,EAAAA,EAAAA,SAAoB,CAClBC,KAAM,OACNP,YAAa,QACbP,KAAM,CACJyB,UAAW,SACXlC,OAAO,IAGZ,GA6DF,C,uBCvHc,SAASsB,EAAoBE,GAC1C,YADwD,IAAdA,IAAAA,EAAU,CAAC,GAEjC,oBAAXX,QACPA,OAAOuB,OAAOnB,YACZO,EACA,IAAIa,gBAAgBC,SAASC,QAAQC,IAAI,UAG9C,C","sources":["webpack://input-fields/./src/pages/paymentActions.ts","webpack://input-fields/./src/pages/card.jsx","webpack://input-fields/./src/pages/postMessageToParent.js"],"sourcesContent":["export const START_PAYMENT = \"start-payment\";\nexport const GET_PAYMENT_DATA = \"GET_PAYMENT_DATA\";\nexport const SEND_PAYMENT_DATA = \"SEND_PAYMENT_DATA\";\nexport const PAYMENT_STATUS = \"payment-status\";\n\nexport default function () {\n  return null;\n}\n","import React, { useEffect, useRef, useState } from \"react\";\nimport postMessageToParent from \"./postMessageToParent\";\nimport {\n  GET_PAYMENT_DATA,\n  SEND_PAYMENT_DATA,\n  START_PAYMENT,\n} from \"./paymentActions\";\nimport \"./styles.css\";\n\nconst channel = new BroadcastChannel(\"payment\");\n\nexport default function Card() {\n  const [value, setValue] = useState(\"\");\n  const [paymentData, setPaymentData] = useState({ card: value });\n  const [parentData, setParentData] = useState(null);\n\n  const updatePaymentData = (name, value) =>\n    setPaymentData((data) => Object.assign({}, data, { [name]: value }));\n\n  const handleChange = (change) => {\n    console.log(\"Iframe => Card changed\");\n    const { value } = change.target;\n\n    if (/^[0-9]{0,19}$/.test(value)) {\n      setValue(value);\n      updatePaymentData(\"card\", value);\n      postMessageToParent({\n        from: \"card\",\n        messageType: \"validation\",\n        data: {\n          valid: /^[0-9]{13,19}$/.test(value),\n        },\n      });\n    }\n  };\n\n  const handleFocus = () => {\n    console.log(\"Iframe => Card focused\");\n    postMessageToParent({\n      from: \"card\",\n      messageType: \"event\",\n      data: {\n        eventName: \"onfocus\",\n        value: true,\n      },\n    });\n  };\n\n  const handleBlur = () => {\n    console.log(\"Iframe => Card blurred\");\n    postMessageToParent({\n      from: \"card\",\n      messageType: \"event\",\n      data: {\n        eventName: \"onblur\",\n        value: true,\n      },\n    });\n  };\n\n  useEffect(() => {\n    if (window) {\n      window.onmessage = (event) => {\n        if (event.data.messageType === START_PAYMENT) {\n          setParentData(event.data.data);\n          channel.postMessage({\n            messageType: GET_PAYMENT_DATA,\n          });\n        }\n      };\n\n      channel.onmessage = (event) => {\n        if (event.data.messageType === SEND_PAYMENT_DATA) {\n          console.log(\"Iframe => Receiving data\", event.data);\n          updatePaymentData(event.data.name, event.data.value);\n        }\n      };\n    }\n  }, []);\n\n  useEffect(() => {\n    if (paymentData.cvv && paymentData.expiry && paymentData.card) {\n      console.log(\"Iframe => Making charge request\", {\n        ...paymentData,\n        ...parentData,\n      });\n      if (paymentData.cvv === \"1111\") {\n        postMessageToParent({\n          from: \"hosted-frames\",\n          messageType: \"payment-status\",\n          data: {\n            message: \"Payment failed\",\n            statusCode: 300,\n          },\n        });\n      } else {\n        postMessageToParent({\n          from: \"hosted-frames\",\n          messageType: \"payment-status\",\n          data: {\n            message: \"Payment done\",\n            statusCode: 200,\n          },\n        });\n      }\n    }\n  }, [paymentData]);\n\n  return (\n    <input\n      type=\"text\"\n      name=\"card\"\n      placeholder=\"13 to 19 digits\"\n      value={value}\n      onChange={handleChange}\n      onFocus={handleFocus}\n      onBlur={handleBlur}\n    />\n  );\n}\n","export default function postMessageToParent(message = {}) {\n  return (\n    typeof window !== \"undefined\" &&\n    window.parent.postMessage(\n      message,\n      new URLSearchParams(location.search).get(\"origin\")\n    )\n  );\n}\n"],"names":["START_PAYMENT","GET_PAYMENT_DATA","SEND_PAYMENT_DATA","PAYMENT_STATUS","channel","BroadcastChannel","Card","useState","value","setValue","card","paymentData","setPaymentData","parentData","setParentData","updatePaymentData","name","data","Object","assign","useEffect","window","onmessage","event","messageType","postMessage","console","log","cvv","expiry","postMessageToParent","from","message","statusCode","type","placeholder","onChange","change","target","test","valid","onFocus","eventName","onBlur","parent","URLSearchParams","location","search","get"],"sourceRoot":""}