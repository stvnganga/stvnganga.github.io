{"version":3,"file":"component---src-pages-card-jsx-2a3bc7c23fe1d8f071f5.js","mappings":"0TAAO,IAAMA,EAAgB,gBAChBC,EAAmB,mBACnBC,EAAoB,oBACpBC,EAAiB,iBAEf,SAAS,IACtB,OAAO,IACR,C,sGCEGC,EACgB,oBAAXC,OAAyB,IAAIC,iBAAiB,WAAa,KAErD,SAASC,IACtB,OAA0BC,EAAAA,EAAAA,UAAS,IAA5BC,EAAP,KAAcC,EAAd,KACA,GAAsCF,EAAAA,EAAAA,UAAS,CAAEG,KAAMF,IAAhDG,EAAP,KAAoBC,EAApB,KACA,GAAoCL,EAAAA,EAAAA,UAAS,MAAtCM,EAAP,KAAmBC,EAAnB,KAEMC,EAAoB,SAACC,EAAMR,GAAP,OACxBI,GAAe,SAACK,GAAD,aAAUC,OAAOC,OAAO,CAAC,EAAGF,IAAlB,MAA2BD,GAAOR,EAAlC,GAAV,GADS,EAkG1B,OAzDAY,EAAAA,EAAAA,YAAU,WACJhB,SACFA,OAAOiB,UAAY,SAACC,GACdA,EAAML,KAAKM,cAAgBxB,EAAAA,gBAC7Be,EAAcQ,EAAML,KAAKA,MACzBd,EAAQqB,YAAY,CAClBD,YAAavB,EAAAA,mBAGlB,EAEDG,EAAQkB,UAAY,SAACC,GACfA,EAAML,KAAKM,cAAgBtB,EAAAA,mBAC7Bc,EAAkBO,EAAML,KAAKD,KAAMM,EAAML,KAAKT,MAEjD,EAEJ,GAAE,KAEHY,EAAAA,EAAAA,YAAU,WACJT,EAAYc,KAAOd,EAAYe,QAAUf,EAAYD,OACvDiB,QAAQC,IAAI,kCAAZ,iBACKjB,EACAE,IAELgB,YAAW,WACe,SAApBlB,EAAYc,KACdK,EAAAA,EAAAA,SAAoB,CAClBC,KAAM,gBACNR,YAAa,iBACbN,KAAM,CACJe,QAAS,iBACTC,WAAY,SAIhBH,EAAAA,EAAAA,SAAoB,CAClBC,KAAM,gBACNR,YAAa,iBACbN,KAAM,CACJe,QAAS,eACTC,WAAY,OAIhB9B,EAAQqB,YAAY,CAClBD,YAAa,UAGfd,EAAS,KAGXG,EAAe,CAAC,EACjB,GAAE,KAEN,GAAE,CAACD,IAGF,yBACEuB,KAAK,OACLlB,KAAK,OACLmB,YAAY,kBACZ3B,MAAOA,EACP4B,SArGiB,SAACC,GACpB,IAAQ7B,EAAU6B,EAAOC,OAAjB9B,MAEJ,gBAAgB+B,KAAK/B,KACvBC,EAASD,GACTO,EAAkB,OAAQP,IAC1BsB,EAAAA,EAAAA,SAAoB,CAClBC,KAAM,OACNR,YAAa,aACbN,KAAM,CACJuB,MAAO,iBAAiBD,KAAK/B,MAIpC,EAwFGiC,QAtFgB,YAClBX,EAAAA,EAAAA,SAAoB,CAClBC,KAAM,OACNR,YAAa,QACbN,KAAM,CACJyB,UAAW,UACXlC,OAAO,IAGZ,EA8EGmC,OA5Ee,YACjBb,EAAAA,EAAAA,SAAoB,CAClBC,KAAM,OACNR,YAAa,QACbN,KAAM,CACJyB,UAAW,SACXlC,OAAO,IAGZ,GAsEF,C,uBC9Hc,SAASsB,EAAoBE,GAC1C,YADwD,IAAdA,IAAAA,EAAU,CAAC,GAEjC,oBAAX5B,QACPA,OAAOwC,OAAOpB,YACZQ,EACA,IAAIa,gBAAgBC,SAASC,QAAQC,IAAI,UAG9C,C","sources":["webpack://input-fields/./src/pages/paymentActions.ts","webpack://input-fields/./src/pages/card.jsx","webpack://input-fields/./src/pages/postMessageToParent.js"],"sourcesContent":["export const START_PAYMENT = \"start-payment\";\nexport const GET_PAYMENT_DATA = \"GET_PAYMENT_DATA\";\nexport const SEND_PAYMENT_DATA = \"SEND_PAYMENT_DATA\";\nexport const PAYMENT_STATUS = \"payment-status\";\n\nexport default function () {\n  return null;\n}\n","import React, { useEffect, useRef, useState } from \"react\";\nimport postMessageToParent from \"./postMessageToParent\";\nimport {\n  GET_PAYMENT_DATA,\n  SEND_PAYMENT_DATA,\n  START_PAYMENT,\n} from \"./paymentActions\";\nimport \"./styles.css\";\n\nlet channel =\n  typeof window !== \"undefined\" ? new BroadcastChannel(\"payment\") : null;\n\nexport default function Card() {\n  const [value, setValue] = useState(\"\");\n  const [paymentData, setPaymentData] = useState({ card: value });\n  const [parentData, setParentData] = useState(null);\n\n  const updatePaymentData = (name, value) =>\n    setPaymentData((data) => Object.assign({}, data, { [name]: value }));\n\n  const handleChange = (change) => {\n    const { value } = change.target;\n\n    if (/^[0-9]{0,19}$/.test(value)) {\n      setValue(value);\n      updatePaymentData(\"card\", value);\n      postMessageToParent({\n        from: \"card\",\n        messageType: \"validation\",\n        data: {\n          valid: /^[0-9]{13,19}$/.test(value),\n        },\n      });\n    }\n  };\n\n  const handleFocus = () => {\n    postMessageToParent({\n      from: \"card\",\n      messageType: \"event\",\n      data: {\n        eventName: \"onfocus\",\n        value: true,\n      },\n    });\n  };\n\n  const handleBlur = () => {\n    postMessageToParent({\n      from: \"card\",\n      messageType: \"event\",\n      data: {\n        eventName: \"onblur\",\n        value: true,\n      },\n    });\n  };\n\n  useEffect(() => {\n    if (window) {\n      window.onmessage = (event) => {\n        if (event.data.messageType === START_PAYMENT) {\n          setParentData(event.data.data);\n          channel.postMessage({\n            messageType: GET_PAYMENT_DATA,\n          });\n        }\n      };\n\n      channel.onmessage = (event) => {\n        if (event.data.messageType === SEND_PAYMENT_DATA) {\n          updatePaymentData(event.data.name, event.data.value);\n        }\n      };\n    }\n  }, []);\n\n  useEffect(() => {\n    if (paymentData.cvv && paymentData.expiry && paymentData.card) {\n      console.log(\"Iframe => Making charge request\", {\n        ...paymentData,\n        ...parentData,\n      });\n      setTimeout(() => {\n        if (paymentData.cvv === \"1111\") {\n          postMessageToParent({\n            from: \"hosted-frames\",\n            messageType: \"payment-status\",\n            data: {\n              message: \"Payment failed\",\n              statusCode: 400,\n            },\n          });\n        } else {\n          postMessageToParent({\n            from: \"hosted-frames\",\n            messageType: \"payment-status\",\n            data: {\n              message: \"Payment done\",\n              statusCode: 200,\n            },\n          });\n\n          channel.postMessage({\n            messageType: \"RESET\",\n          });\n\n          setValue(\"\");\n        }\n\n        setPaymentData({});\n      }, 2000);\n    }\n  }, [paymentData]);\n\n  return (\n    <input\n      type=\"text\"\n      name=\"card\"\n      placeholder=\"13 to 19 digits\"\n      value={value}\n      onChange={handleChange}\n      onFocus={handleFocus}\n      onBlur={handleBlur}\n    />\n  );\n}\n","export default function postMessageToParent(message = {}) {\n  return (\n    typeof window !== \"undefined\" &&\n    window.parent.postMessage(\n      message,\n      new URLSearchParams(location.search).get(\"origin\")\n    )\n  );\n}\n"],"names":["START_PAYMENT","GET_PAYMENT_DATA","SEND_PAYMENT_DATA","PAYMENT_STATUS","channel","window","BroadcastChannel","Card","useState","value","setValue","card","paymentData","setPaymentData","parentData","setParentData","updatePaymentData","name","data","Object","assign","useEffect","onmessage","event","messageType","postMessage","cvv","expiry","console","log","setTimeout","postMessageToParent","from","message","statusCode","type","placeholder","onChange","change","target","test","valid","onFocus","eventName","onBlur","parent","URLSearchParams","location","search","get"],"sourceRoot":""}